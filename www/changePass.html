
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/docs/4.0/assets/img/favicons/favicon.ico">

    <!-- <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/dashboard/"> -->

    <!-- Bootstrap core CSS -->
    <!-- <link href="../../dist/css/bootstrap.min.css" rel="stylesheet"> -->

    <!-- Custom styles for this template -->
    <!-- <link href="dashboard.css" rel="stylesheet"> -->
    <link rel="apple-touch-icon" sizes="76x76" href="./css/assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="./css/assets/img/favicon.png">
    <title>
    HOSTEL MANAGEMENT SYSTEM 
    </title>
    <!--   Fonts and icons     -->
    <link href="./css/assets/js/family.css" rel="stylesheet" />
    
    <!-- Nucleo Icons -->
    <link href="./css/assets/css/nucleo-icons.css" rel="stylesheet" />
    <link href="./css/assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- Font Awesome Icons -->
  
    
    <link href="./css/assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link id="pagestyle" href="./css/assets/css/dashboardStyles.css" rel="stylesheet" />
    <link id="pagestyle" href="./css/assets/css/dashboard2.css" rel="stylesheet" />
  </head>

  <body>
    <nav class="navbar  sticky-top bg-dark flex-md-nowrap p-0">
      <h3 class="navbar gradient-heading">HMS</h3>
      
      <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
          <a class="nav-link" href="index.html">Sign out</a>
        </li>
      </ul>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
          <div class="sidebar-sticky">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link " href="home.html">
                  <span data-feather="home"></span>
                  Dashboard <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="rooms.html">
                  <span data-feather="file"></span>
                  Room Details
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="student.html">
                  <span data-feather="file"></span>
                 Student Details
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="fees.html">
                  <span data-feather="shopping-cart"></span>
                  Fee Details
                </a>
              </li>
           
              <li class="nav-item">
                <a class="nav-link" href="expenses.html">
                  <span data-feather="bar-chart-2"></span>
                  Expenses
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link " href="category.html">
                  <span data-feather="bar-chart-2"></span>
                  Category
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="changePass.html">
                  <span data-feather="bar-chart-2"></span>
                  Change Password
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
            <h1 class="h2">Manage Password </h1>
          </div>
          
          <div class="row justify-content-center">
            <div class="col-md-6">
              <div class="card custom-shadow">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                  <h4>Change Password</h4>
                  <button class="btn btn-light btn-sm" onclick="app.password.changePassword()">Change</button>
              </div>
                <div class="card-body">
                    <!-- Change Password Form -->
                    <form id="changePasswordForm">
                        <div class="form-row align-items-end">
                          <div class="col-md-12 mb-3">
                            <label for="username">Username</label>
                            <input type="text" class="form-control" id="username" placeholder="Enter Username" readonly required>
                         </div>
                            <div class="col-md-12 mb-3">
                                <label for="current_password">Current Password</label>
                                <input type="text" class="form-control" id="current_password" readonly placeholder="Enter Current Password" required>
                            </div>
                            <div class="row px-1" id="updatePass_block" style="display: none">
                            <div class="col-md-12 mb-3">
                                <label for="new_password">New Password</label>
                                <input type="text" class="form-control" id="new_password" placeholder="Enter New Password" required>
                            </div>
                          
                              <div class="col-md-12 mb-3">
                                <label for="confirm_password">Confirm New Password</label>
                                <input type="text" class="form-control" id="confirm_password" placeholder="Confirm New Password" required>
                            </div>
                            <div class="col-md-12">
                                <button type="button" class="btn btn-success btn-block" onclick="app.password.updatePassword()">Change Password</button>
                            </div>
                          </div>
                        </div>
                    </form>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
   
    
  <script src="./lib/jquery/jquery-3.6.3.min.js"></script>
  <link href="./css/assets/css/toastr.css" rel="stylesheet"/>
  <script src="./css/assets/js/toastr.js"></script>
  <!--   <script src="./lib/bootstrap/js/bootstrap.min.js"></script> -->
  <script src="./css/assets/js/core/popper.min.js"></script>
  <script src="./css/assets/js/core/bootstrap.min.js"></script>
  <script src="./css/assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="./css/assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="./css/assets/js/soft-ui-dashboard.min.js?v=1.0.7"></script>
  <script src="./css/assets/js/42d5adcbca.js" crossorigin="anonymous"></script>
  <script src="./js/database.js"></script>
  <script src="./js/general.js"></script>
  <script src="./js/db/customerTables.js"></script>
  <!-- <script src="./js/home.js"></script> -->
  <script src="./js/db/businessLogic.js"></script>
  <script>
    $(document).ready(() => {
    app.database.createDB();
    app.password.getLog();
   });
   app.password = {

    getLog: () => {
        
        const selectLog = `SELECT * from logins`;
        $.when(app.database.tables.dbOparations.getData(selectLog))
            .done(function (data) {
              // console.log(data);
              $('#username').val(data[0].USERNAME);
              $('#current_password').val(data[0].PASSWORD);
            })  
    },

        updatePassword :  () =>{

        let username = $('#username').val();
        let currentPassword = $('#current_password').val();
        let newPassword = $('#new_password').val();
        let confirmPassword = $('#confirm_password').val();

        // Validation
        if (!username || !currentPassword || !newPassword || !confirmPassword) {
          toastr.error('All fields are required.', '', { timeOut: 1000 });
          return;
        }

        if (newPassword !== confirmPassword) {
          toastr.error('New Password and Confirm Password do not match.', '', { timeOut: 1000 });
          return;
        }

        // SQL Query to Update Password
        const updateQuery = `
          UPDATE logins
          SET PASSWORD = '${newPassword}'
          WHERE USERNAME = '${username}' AND PASSWORD = '${currentPassword}';
        `;

        // Execute the update query
        $.when(app.database.tables.dbOparations.execute(updateQuery))
          .done(function (result) {
            toastr.success('Password updated successfully!', '', { timeOut: 1000 });
            location.reload();
          })
          .fail(function (error) {   
           toastr.error('An error occurred while updating the password.', '', { timeOut: 1000});
      
          });
        },

    changePassword : ()=>{
      $('#updatePass_block').toggle(); // Show or hide the block
    }

   }
  </script>

  </body>
</html>
